# Gear Calculations

My code for calculating the gear ratios was done quickly without much thought for reuse â€“ but I'll add some notes here in case it's useful.

The code was written in javascript and is located in a Github repository here. I really liked this online [Gear Train app](http://scientific601.altervista.org/gear/gearcalc.html) and used it as a starting point as I began to design my gear trains, but found that I needed to calculate a large set of good gear trains for a given gear ratio instead of just the single most optimal configuration. The file GearGenerator.js contains a function that performs an exhaustive search to find set of gears meeting min tooth, max tooth, number of stages, and maximum error requirements (it takes about ten minutes to complete). The solutions are printed as a tsv to the console, so they can easily be copied and pasted into a spreadsheet.

First I used GearGenerator.js to calculate optimal solutions for a 3 stage gear train to drive the rotation of the moon around the earth. I chose a minimum tooth number of 8 and a maximum of 55. My code found the same optimal ratios as the online gear train app, but also gave me many alternatives that were slightly less optimal from an error perspective, but may satisfy other geometric properties of interest. I saved all permutations of each of these options (called "hits" in GearGenerator.js) to a global variable called "options".

CalcFit.js uses the information stored in "options" to assess the options in terms of geometric constraints. Since I made my parts using a CNC machine, I allowed for a small amount of scaling of the tooth pitch to help open up the available gear options, but I didn't want the difference in tooth scale to be too noticeable. CalcFit.js determines the amount of scaling needed by the third stage of the moon orbit train to make it coaxial with the mirrored ecliptic train.

I wanted to drive one of the remaining gear trains (perigee or nodes) from a single stage off the fourth axle in my five axle setup, so I calculated optimal single stage trains for driving either the perigee or the nodes and printed this as a single tsv (pasted here - "Moon Orbit"). I found a few good options for a single stage to drive the nodes (highlighted in blue and magenta), and another for a single stage to drive the perigee (highlighted in orange).

Next I used GearGenerator.js to calculate a set of optimal 2 stage trains to be driven off the third axle of the moon orbit train. I pasted the resulting tsv here, here, and here - "Option # Gear Ratios". Again, I analyzed the spreadsheet and chose an optimal perigee gear configuration that met my design requirements. There is no right answer here - it's a balance of aesthetics, complexity of design/manufacturing, and accuracy. I ended up choosing the solution in blue initially to minimize error and used this for version 1 of my design. Later I decided that I didn't like the large pitch scaling on one of the gear stages, so I choose the magenta option instead for version 2.

Finally I added a year counter that ticks over each time the arm makes one full revolution. I calculated the gear ratios for this train by hand, so that I could fit 100 years (plus some extra) in one full revolution. I ended up finding a set of gear ratios that fits 135 years on one full revolution, rotating in the same direction as the arm. I only marked off 100 years plus ten on either side.